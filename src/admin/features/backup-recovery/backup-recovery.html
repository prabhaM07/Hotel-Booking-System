<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Backup & Restore - Zyra Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

    <style>
        /* Professional color scheme */
        .border-primary { border-color: #2563EB; } /* Professional Blue */
        .border-secondary { border-color: #64748B; } /* Slate Gray */
        .border-accent { border-color: #059669; } /* Professional Green */
        .bg-primary { background-color: #2563EB; }
        .bg-secondary { background-color: #64748B; }
        .bg-accent { background-color: #059669; }
        .text-primary { color: #2563EB; }
        .text-secondary { color: #64748B; }
        .text-accent { color: #059669; }
        .hover\:bg-primary:hover { background-color: #1D4ED8; }
        .hover\:bg-secondary:hover { background-color: #475569; }
        .hover\:bg-accent:hover { background-color: #047857; }
        .hover\:border-primary:hover { border-color: #2563EB; }
        .hover\:border-secondary:hover { border-color: #64748B; }
        .focus\:ring-primary:focus { --tw-ring-color: #2563EB; }
        .focus\:border-primary:focus { border-color: #2563EB; }

        /* Professional gradient */
        .bg-professional-gradient {
            background: linear-gradient(135deg, #1E40AF 0%, #3730A3 50%, #5B21B6 100%);
        }

        /* Professional shadows */
        .professional-shadow {
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        .professional-shadow-lg {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .animate-slideDown { animation: slideDown 0.3s ease-out; }
        .animate-fadeIn { animation: fadeIn 0.3s ease-out; }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .animate-spin { animation: spin 1s linear infinite; }

        @keyframes progress {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        .progress-bar {
            animation: progress var(--duration, 3s) ease-in-out forwards;
        }

        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }

        .hover-scale {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .hover-scale:hover {
            transform: scale(1.02);
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen">
    <!-- Mobile Overlay -->
    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>

    <!-- External Toggle Button -->
    <button id="externalToggle" class="fixed top-4 left-4 z-50 p-2 bg-white text-gray-600 rounded-lg professional-shadow-lg hover:shadow-xl hover:bg-gray-50 transition-all duration-300 hidden border border-gray-200">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
        </svg>
    </button>

    <!-- Sidebar (keeping original colors) -->
    <aside id="sidebar" class="fixed top-0 left-0 w-80 h-full bg-[#1D1354] text-white flex flex-col transform transition-transform duration-300 z-50 overflow-hidden">
        <!-- Sidebar Header -->
        <div class="flex items-center justify-between p-4 h-16 border-b border-[#2E1B8C] relative">
            <h2 class="text-2xl lg:text-3xl font-extrabold bg-gradient-to-r from-orange-400 via-red-500 to-pink-600 bg-clip-text text-transparent">
                Zyra
            </h2>
            <button id="sidebarToggle" class="hover:bg-[#2E1B8C] p-2 rounded transition-all duration-300 relative z-10">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                </svg>
            </button>
        </div>

        <!-- Navigation -->
        <nav class="flex-1 px-4 py-6 space-y-2 text-sm overflow-y-hidden">
            <a href="#" class="block px-3 py-3 rounded-md hover:bg-[#2E1B8C] font-semibold text-lg">Dashboard</a>

            <!-- Booking Dropdown -->
            <div>
                <button id="bookingToggle" class="flex items-center justify-between w-full px-3 py-3 rounded-md hover:bg-[#2E1B8C] transition-colors">
                    <span class="font-semibold text-lg">Booking</span>
                    <svg id="bookingArrow" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </button>
                <div id="bookingSubmenu" class="ml-4 mt-2 space-y-1 overflow-hidden transition-all duration-300" style="max-height: 0px">
                    <a href="/src/admin/features/booking/refund-Booking.html" class="block px-3 py-2 hover:bg-[#2E1B8C] rounded-md transition-colors font-semibold">Refund Bookings</a>
                    <a href="/src/admin/features/booking/bookingRecords.html" class="block px-3 py-2 hover:bg-[#2E1B8C] rounded-md transition-colors font-semibold">Booking Records</a>
                </div>
            </div>

            <a href="/src/admin/features/rooms/rooms.html" id="rooms" class="block px-3 py-3 hover:bg-[#2E1B8C] rounded-md font-semibold text-lg transition-colors">Rooms</a>
            <a href="/src/admin/features/ratings-reviews/reviews-ratings.html" id="ratingsReviews" class="block px-3 py-3 hover:bg-[#2E1B8C] rounded-md font-semibold text-lg transition-colors">Ratings and Reviews</a>
            <a href="#" id="userQueries" class="block px-3 py-3 hover:bg-[#2E1B8C] rounded-md font-semibold text-lg transition-colors">User Queries</a>
            <a href="/src/admin/features/feature-facilities/feature-facilities.html" id="featuresFacilities" class="block px-3 py-3 hover:bg-[#2E1B8C] rounded-md font-semibold text-lg transition-colors">Features & Facilities</a>
            <a href="/src/admin/features/backup-recovery/backup-recovery.html" class="block px-3 py-3 bg-[#2E1B8C] rounded-md font-semibold text-lg transition-colors">Backup & Restore</a>
            <a href="/src/admin/features/content-management/content-management.html" id="settings" class="block px-3 py-3 hover:bg-[#2E1B8C] rounded-md font-semibold text-lg transition-colors">Content Management</a>
        </nav>

        <!-- Profile Section -->
        <div class="p-4 border-t border-[#2E1B8C] relative">
            <div class="flex items-center space-x-3 cursor-pointer hover:bg-[#2E1B8C] rounded-lg p-2 transition-colors duration-200">
                <a
                    href="#"
                    onclick="logout()"
                    class="flex items-center px-4 py-2 rounded-lg shadow-sm hover:drop-shadow-md text-white-600"
                >
                    <svg
                        class="w-5 h-5 mr-3"
                        fill="currentColor"
                        viewBox="0 0 20 20"
                    >
                        <path
                            fill-rule="evenodd"
                            clip-rule="evenodd"
                            d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z"
                        />
                    </svg>
                    <span class="font-medium text-basex">Logout</span>
                </a>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <div id="mainContent" class="min-h-screen transition-all duration-300 lg:ml-80">
        <main class="p-4 sm:p-6 lg:p-8">
            <!-- Header -->
            <div class="mb-8">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900">Backup & Restore</h1>
                        <div class="h-1 w-32 bg-primary rounded-full mt-2"></div>
                        <p class="text-gray-600 mt-4">Manage your system data backups and restoration processes</p>
                    </div>
                    <div class="flex items-center space-x-2 bg-green-50 px-4 py-2 rounded-lg border border-green-200">
                        <div class="w-2 h-2 bg-accent rounded-full animate-pulse"></div>
                        <span class="text-accent text-sm font-medium">System Online</span>
                    </div>
                </div>
            </div>

            <!-- Main Actions -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Backup Section -->
                <div class="bg-white rounded-xl professional-shadow-lg border border-gray-200 hover-scale">
                    <div class="p-6 border-b border-gray-200 bg-professional-gradient">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                </svg>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-white">Create Backup</h3>
                                <p class="text-sm text-white text-opacity-90">Export your system data securely</p>
                            </div>
                        </div>
                    </div>

                    <div class="p-6">
                        <div class="space-y-6">
                            <div>
                                <label class="text-sm font-medium text-gray-700 mb-4 block">Select Data Types to Backup</label>
                                <div class="space-y-4">
                                    <label class="flex items-center justify-between p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                                        <div class="flex items-center space-x-3">
                                            <input type="checkbox" id="backupRooms" class="w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary" checked>
                                            <div class="flex items-center space-x-2">
                                                <svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z" />
                                                </svg>
                                                <div>
                                                    <span class="text-gray-900 font-medium">Rooms Data</span>
                                                    <p class="text-xs text-gray-500">Room information and details</p>
                                                </div>
                                            </div>
                                        </div>
                                        <span class="text-sm text-primary font-medium" id="roomsCount">0 records</span>
                                    </label>

                                    <label class="flex items-center justify-between p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                                        <div class="flex items-center space-x-3">
                                            <input type="checkbox" id="backupBookings" class="w-4 h-4 text-accent border-gray-300 rounded focus:ring-accent" checked>
                                            <div class="flex items-center space-x-2">
                                                <svg class="w-4 h-4 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                                </svg>
                                                <div>
                                                    <span class="text-gray-900 font-medium">Booking Records</span>
                                                    <p class="text-xs text-gray-500">Customer bookings and reservations</p>
                                                </div>
                                            </div>
                                        </div>
                                        <span class="text-sm text-accent font-medium" id="bookingsCount">0 records</span>
                                    </label>

                                    <label class="flex items-center justify-between p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                                        <div class="flex items-center space-x-3">
                                            <input type="checkbox" id="backupFacilities" class="w-4 h-4 text-secondary border-gray-300 rounded focus:ring-secondary" checked>
                                            <div class="flex items-center space-x-2">
                                                <svg class="w-4 h-4 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                                                </svg>
                                                <div>
                                                    <span class="text-gray-900 font-medium">Facilities Data</span>
                                                    <p class="text-xs text-gray-500">Available facilities and amenities</p>
                                                </div>
                                            </div>
                                        </div>
                                        <span class="text-sm text-secondary font-medium" id="facilitiesCount">0 records</span>
                                    </label>
                                </div>
                            </div>

                            <div class="border-t border-gray-200 pt-6">
                                <label class="text-sm font-medium text-gray-700 mb-4 block">Export Format</label>
                                <div class="grid grid-cols-2 gap-4">
                                    <label class="flex items-center justify-center p-4 border-2 border-primary rounded-lg cursor-pointer hover:bg-blue-50 transition-colors bg-blue-50">
                                        <input type="radio" name="exportFormat" value="json" class="sr-only" checked>
                                        <div class="text-center">
                                            <svg class="w-8 h-8 text-primary mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                            </svg>
                                            <span class="text-sm font-medium text-primary">JSON Format</span>
                                        </div>
                                    </label>
                                    <label class="flex items-center justify-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                                        <input type="radio" name="exportFormat" value="excel" class="sr-only">
                                        <div class="text-center">
                                            <svg class="w-8 h-8 text-accent mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                            </svg>
                                            <span class="text-sm font-medium text-accent">Excel Format</span>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <button onclick="showBackupConfirmation()" class="w-full bg-professional-gradient hover:from-blue-700 hover:to-purple-700 text-white px-6 py-3 rounded-lg font-medium transition-all duration-200 flex items-center justify-center space-x-2 professional-shadow-lg hover:shadow-xl">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                </svg>
                                <span>Create Backup</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Restore Section -->
                <div class="bg-white rounded-xl professional-shadow-lg border border-gray-200 hover-scale">
                    <div class="p-6 border-b border-gray-200 bg-professional-gradient">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" />
                                </svg>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-white">Restore Data</h3>
                                <p class="text-sm text-white text-opacity-90">Import and restore system data</p>
                            </div>
                        </div>
                    </div>

                    <div class="p-6">
                        <div class="space-y-6">
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-primary transition-colors cursor-pointer" id="dropZone">
                                <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <h3 class="text-lg font-medium text-gray-900 mb-2">Drop your backup file here</h3>
                                <p class="text-sm text-gray-500 mb-4">Supports JSON and Excel formats up to 50MB</p>
                                <input type="file" id="restoreFile" class="hidden" accept=".json,.xlsx,.xls">
                                <button onclick="document.getElementById('restoreFile').click()" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors">
                                    Choose File
                                </button>
                            </div>

                            <div id="fileInfo" class="hidden bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-4 border border-primary">
                                <div class="flex items-center space-x-3">
                                    <svg class="w-8 h-8 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                    <div class="flex-1">
                                        <p class="font-medium text-gray-900" id="fileName"></p>
                                        <p class="text-sm text-gray-500" id="fileSize"></p>
                                        <p class="text-xs text-accent font-medium" id="fileStatus">Ready to restore</p>
                                    </div>
                                    <button onclick="clearFile()" class="text-red-600 hover:text-red-700 p-1 rounded transition-colors">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <button onclick="showRestoreConfirmation()" id="restoreBtn" class="w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white px-6 py-3 rounded-lg font-medium transition-all duration-200 flex items-center justify-center space-x-2 opacity-50 cursor-not-allowed professional-shadow-lg hover:shadow-xl" disabled>
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                                </svg>
                                <span>Restore Data</span>
                            </button>

                            <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
                                <div class="flex items-start space-x-3">
                                    <svg class="w-5 h-5 text-amber-600 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z" />
                                    </svg>
                                    <div>
                                        <h4 class="text-sm font-medium text-amber-800">Important Notice</h4>
                                        <p class="text-sm text-amber-700 mt-1">Restoring data will overwrite existing records. Please ensure you have a current backup before proceeding.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Backups -->
            <div class="mt-8">
                <div class="bg-white rounded-xl professional-shadow-lg border border-gray-200">
                    <div class="p-6 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900">Recent Backups</h3>
                        <p class="text-sm text-gray-600">View and manage your recent backup files</p>
                    </div>
                    <div class="p-6">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-professional-gradient text-white">
                                    <tr>
                                        <th class="text-left py-3 px-4 font-semibold text-sm uppercase tracking-wider rounded-tl-lg">Date & Time</th>
                                        <th class="text-left py-3 px-4 font-semibold text-sm uppercase tracking-wider">Data Types</th>
                                        <th class="text-left py-3 px-4 font-semibold text-sm uppercase tracking-wider">Format</th>
                                        <th class="text-left py-3 px-4 font-semibold text-sm uppercase tracking-wider">Size</th>
                                        <th class="text-left py-3 px-4 font-semibold text-sm uppercase tracking-wider">Status</th>
                                        <th class="text-left py-3 px-4 font-semibold text-sm uppercase tracking-wider rounded-tr-lg">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="backupHistory">
                                    <tr class="border-b border-gray-100">
                                        <td colspan="6" class="text-center py-8 text-gray-500">
                                            <svg class="w-12 h-12 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                            </svg>
                                            <p>No backups created yet</p>
                                            <p class="text-sm">Create your first backup to see it here</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
(() => {
  // Elements
  const restoreInput = document.getElementById('restoreFile');
  const dropZone = document.getElementById('dropZone');
  const restoreBtn = document.getElementById('restoreBtn');
  const fileInfo = document.getElementById('fileInfo');
  const fileNameEl = document.getElementById('fileName');
  const fileSizeEl = document.getElementById('fileSize');
  const fileStatusEl = document.getElementById('fileStatus');

  // Helpers
  function enableRestore(file) {
    if (!file) return;
    fileInfo?.classList.remove('hidden');
    if (fileNameEl) fileNameEl.textContent = file.name;
    if (fileSizeEl) fileSizeEl.textContent = `${(file.size / 1024 / 1024).toFixed(2)} MB`;
    if (fileStatusEl) fileStatusEl.textContent = 'Ready to restore';
    if (restoreBtn) {
      restoreBtn.disabled = false;
      restoreBtn.classList.remove('opacity-50', 'cursor-not-allowed');
    }
  }
  function setFileStatus(text) {
    if (fileStatusEl) fileStatusEl.textContent = text;
  }
  function downloadBlob(filename, blob) {
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    a.click();
    URL.revokeObjectURL(url);
  }

  // Exposed because HTML uses onclick on the “x” button
  function clearFile() {
    if (restoreInput) restoreInput.value = '';
    fileInfo?.classList.add('hidden');
    if (fileNameEl) fileNameEl.textContent = '';
    if (fileSizeEl) fileSizeEl.textContent = '';
    if (fileStatusEl) fileStatusEl.textContent = '';
    if (restoreBtn) {
      restoreBtn.disabled = true;
      restoreBtn.classList.add('opacity-50', 'cursor-not-allowed');
    }
  }
  window.clearFile = clearFile; // keep inline handler working

  // Backup
  async function createBackup() {
    const rooms = document.getElementById('backupRooms')?.checked || false;
    const bookings = document.getElementById('backupBookings')?.checked || false;
    const facilities = document.getElementById('backupFacilities')?.checked || false;
    const format = document.querySelector('input[name="exportFormat"]:checked')?.value || 'json';

    // TODO: fetch real data here if desired; placeholder empty arrays
    const data = {
      meta: {
        generatedAt: new Date().toISOString(),
        format,
        selections: { rooms, bookings, facilities }
      },
      rooms: rooms ? [] : [],
      bookings: bookings ? [] : [],
      facilities: facilities ? [] : []
    };

    if (format === 'json') {
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      downloadBlob(`zyra-backup-${Date.now()}.json`, blob);
    } else {
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(data.rooms), 'Rooms');
      XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(data.bookings), 'Bookings');
      XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(data.facilities), 'Facilities');
      XLSX.writeFile(wb, `zyra-backup-${Date.now()}.xlsx`);
    }

    // Optional: append a row in backup history UI
    const history = document.getElementById('backupHistory');
    if (history) {
      const tr = document.createElement('tr');
      tr.className = 'border-b border-gray-100';
      tr.innerHTML = `
        <td class="py-3 px-4">${new Date().toLocaleString()}</td>
        <td class="py-3 px-4">${Object.entries(data.meta.selections).filter(([,v])=>v).map(([k])=>k).join(', ') || 'None'}</td>
        <td class="py-3 px-4">${format.toUpperCase()}</td>
        <td class="py-3 px-4">—</td>
        <td class="py-3 px-4 text-green-600">Created</td>
        <td class="py-3 px-4">—</td>
      `;
      history.innerHTML = '';
      history.appendChild(tr);
    }
  }

  function showBackupConfirmation() {
    const ok = window.confirm('Create backup with the selected options?');
    if (!ok) return;
    createBackup();
  }
  window.showBackupConfirmation = showBackupConfirmation; // keep inline handler working

  // Restore
  function showRestoreConfirmation() {
    const file = restoreInput?.files?.[0];
    if (!file) { alert('Please choose a backup file first.'); return; }
    const ok = window.confirm('Restore data from the selected file? This will overwrite existing records.');
    if (!ok) return;

    const ext = file.name.split('.').pop().toLowerCase();
    const reader = new FileReader();

    reader.onload = (e) => {
      try {
        if (ext === 'json') {
          const json = JSON.parse(String(e.target.result || ''));
          // TODO: apply json.data.* to system
          setFileStatus('Restore completed successfully.');
        } else if (ext === 'xlsx' || ext === 'xls') {
          const wb = XLSX.read(e.target.result, { type: 'binary' });
          // Example: const rooms = XLSX.utils.sheet_to_json(wb.Sheets['Rooms'] || {});
          setFileStatus('Restore completed successfully.');
        } else {
          setFileStatus('Unsupported file type.');
        }
      } catch (err) {
        setFileStatus(`Restore failed: ${err.message}`);
      }
    };

    if (ext === 'json') reader.readAsText(file); else reader.readAsBinaryString(file);
  }
  window.showRestoreConfirmation = showRestoreConfirmation; // keep inline handler working

  // Add listeners (recommended pattern)
  document.addEventListener('DOMContentLoaded', () => {
    // Map current inline “Choose File” button to open the input if needed
    restoreInput?.addEventListener('change', (e) => {
      const f = e.target.files?.[0];
      if (f) enableRestore(f);
    });

    // Drag & drop
    dropZone?.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('border-primary'); });
    dropZone?.addEventListener('dragleave', () => { dropZone.classList.remove('border-primary'); });
    dropZone?.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone.classList.remove('border-primary');
      const file = e.dataTransfer.files?.[0];
      if (file && restoreInput) {
        // assign files to input so restore button can use it
        restoreInput.files = e.dataTransfer.files;
        enableRestore(file);
      }
    });
  });
})();
</script>


    <script src="sidebar.js"></script>
</body>
</html>