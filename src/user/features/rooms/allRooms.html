<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zyra Hotel - Bookings</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <!-- Google Fonts: Montserrat -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      font-family: 'Montserrat', sans-serif;
    }
    .links:hover {
    color: #EFB85A;
   
  }
  .links{
    cursor: pointer;
    transition: all 0.3s ease;
  }
  </style>
</head>
<body class="m-0 p-0">
  <!-- Header -->
  <header class="fixed top-0 w-full z-50 shadow-md bg-white">
    <nav class="flex h-16 items-center justify-between px-6">
      <!-- Logo -->
      <div>
        <img src="/src/assets/logo.png" alt="Zyra Hotel Logo" class="h-10 w-auto" />
      </div>
      
      <div class="flex items-center space-x-4">
        <!-- Menu + Book Now -->
        <div class="flex items-center space-x-4">
                    <ul class="hidden md:flex space-x-6 font-semibold text-[#413030]">
            <li>
              <span class="text-cursor-pointer relative inline-block group">
                <a href="/src/index.html" class="hover:text-yellow-400 transition">Home</a>
                <span class="absolute left-0 bottom-0 h-[1px] w-0 bg-[#F26538] transition-all duration-300 group-hover:w-full"></span>
              </span>
            </li>
            <li>
              <span class="cursor-pointer relative inline-block group">
                <a href="/src/user/features/rooms/allRooms.html" class="hover:text-yellow-400 transition">Rooms</a>
                <span class="absolute left-0 bottom-0 h-[1px] w-0 bg-[#F26538] transition-all duration-300 group-hover:w-full"></span>
              </span>
            </li>
            <li>
              <span class="text-cursor-pointer relative inline-block group">
                <a href="/src/user/features/facilities/facilities.html" class="hover:text-yellow-400 transition">Facilities</a>
                <span class="absolute left-0 bottom-0 h-[1px] w-0 bg-[#F26538] transition-all duration-300 group-hover:w-full"></span>
              </span>
            </li>
            <li>
              <span class="text-cursor-pointer relative inline-block group">
                <a href="/src/user/features/contact/contactUs.html" class="hover:text-yellow-400 transition">Contact Us</a>
                <span class="absolute left-0 bottom-0 h-[1px] w-0 bg-[#F26538] transition-all duration-300 group-hover:w-full"></span>
              </span>
            </li>
          </ul>

          <button id = "homeBookNow-btn" onclick = "redirectRoom()" class="rounded-full px-4 py-3 text-white text-sm font-semibold bg-[#EFB85A] hover:bg-[#F26538] transition">
            Book Now
          </button>
        </div>

        <!-- Mobile Icons -->
        <div id="mobileIcons" class="flex relative h-full items-center cursor-pointer">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" 
              stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" 
                  d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" 
              fill="#C2C6CC" class="w-8 h-8">
            <path fill-rule="evenodd"
                  d="M18.685 19.097A9.723 9.723 0 0 0 21.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 0 0 3.065 7.097A9.716 9.716 0 0 0 12 21.75a9.716 9.716 0 0 0 6.685-2.653Zm-12.54-1.285A7.486 7.486 0 0 1 12 15a7.486 7.486 0 0 1 5.855 2.812A8.224 8.224 0 0 1 12 20.25a8.224 8.224 0 0 1-5.855-2.438ZM15.75 9a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" 
                  clip-rule="evenodd"/>
          </svg>
        </div>

      </div>
    </nav>
  </header>

  <div id="mainContent" class="min-h-screen transition-all duration-300 pt-16">
    <main id="mainContentArea" class="w-full p-4 sm:p-6 lg:p-8 mt-4 sm:mt-6 lg:mt-0">
      
      <!-- Header and Filters on same horizontal line -->
      <div class="relative flex items-center mb-8">
        
        <!-- Filters (left side) -->
        <button
          id="filtersBtn"
          onclick="toggleFilterSidebar()"
          class="flex items-center gap-2 px-4 py-2 border border-[#EFB85A] rounded-full hover:scale-105 transition-colors"
        >
          <svg class="h-4 w-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="#F26538">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.207A1 1 0 013 6.5V4z" />
          </svg>
          <span class="text-gray-700">Filters</span>
        </button>
        
        <!-- Title (centered absolutely) -->
        <h1 
          id="dashboardTitle" 
          class="relative left-1/2 transform -translate-x-1/2 text-3xl sm:text-2xl lg:text-3xl font-bold text-gray-800 transition-all duration-300"
        >
        <div class="absolute -bottom-3 ml-12 left-0 w-20 h-1 bg-gradient-to-r from-[#EFB85A] to-[#F26538] rounded-full"></div>
          OUR ROOMS
        </h1>
      </div>
      
      
<!-- Filter Sidebar Overlay -->
<div id="filterOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden transition-opacity duration-300" onclick="closeFilterSidebar()"></div>

<!-- Filter Sidebar -->
<div id="filterSidebar" class="fixed left-0 top-0 h-full w-80 bg-white shadow-2xl z-50 transform -translate-x-full transition-transform duration-300 ease-in-out">
  
  <!-- Sidebar Header -->
  <div class="flex items-center justify-between p-6 border-b border-gray-200">
    <div class="flex items-center gap-3">
      <svg class="h-5 w-5 text-[#F26538]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.207A1 1 0 013 6.5V4z" />
      </svg>
      <h2 class="text-xl font-bold text-gray-800">Filters</h2>
    </div>
    <button onclick="closeFilterSidebar()" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
      <svg class="h-5 w-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
  </div>
  
  <!-- Sidebar Content -->
  <div class="p-6 overflow-y-auto h-full pb-32">
    
    <!-- Check In/Out -->
    <div class="mb-8">
      <div class="space-y-4 mb-4">
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Check In</label>
          <input type="date" id="checkInDate" class="w-full px-3 py-2 border border-[#F26538] rounded-lg focus:ring-2 focus:ring-[#EFB85A] focus:border-[#EFB85A] outline-none">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Check Out</label>
          <input type="date" id="checkOutDate" class="w-full px-3 py-2 border border-[#F26538] rounded-lg focus:ring-2 focus:ring-[#EFB85A] focus:border-[#EFB85A] outline-none">
        </div>
      </div>
    </div>

    <!-- Features -->
    <div class="mb-8">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">Features</h3>
      <div class="space-y-3">
        <label class="flex items-center">
          <input type="checkbox" class="rounded border-gray-300 text-[#EFB85A] focus:ring-[#EFB85A]" data-filter="feature" data-value="bedroom">
          <span class="ml-3 text-gray-700">Bedroom</span>
        </label>
        <label class="flex items-center">
          <input type="checkbox" class="rounded border-gray-300 text-[#EFB85A] focus:ring-[#EFB85A]" data-filter="feature" data-value="kitchen">
          <span class="ml-3 text-gray-700">Kitchen</span>
        </label>
        <label class="flex items-center">
          <input type="checkbox" class="rounded border-gray-300 text-[#EFB85A] focus:ring-[#EFB85A]" data-filter="feature" data-value="balcony">
          <span class="ml-3 text-gray-700">Balcony</span>
        </label>
      </div>
    </div>
    
    <!-- Facilities -->
    <div class="mb-8">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">Facilities</h3>
      <div class="space-y-3">
        <label class="flex items-center">
          <input type="checkbox" class="rounded border-gray-300 text-[#EFB85A] focus:ring-[#EFB85A]" data-filter="facility" data-value="wifi">
          <span class="ml-3 text-gray-700">WiFi</span>
        </label>
        <label class="flex items-center">
          <input type="checkbox" class="rounded border-gray-300 text-[#EFB85A] focus:ring-[#EFB85A]" data-filter="facility" data-value="air conditioner">
          <span class="ml-3 text-gray-700">Air Conditioner</span>
        </label>
        <label class="flex items-center">
          <input type="checkbox" class="rounded border-gray-300 text-[#EFB85A] focus:ring-[#EFB85A]" data-filter="facility" data-value="tv">
          <span class="ml-3 text-gray-700">Television</span>
        </label>
        <label class="flex items-center">
          <input type="checkbox" class="rounded border-gray-300 text-[#EFB85A] focus:ring-[#EFB85A]" data-filter="facility" data-value="room heater">
          <span class="ml-3 text-gray-700">Room Heater</span>
        </label>
        <label class="flex items-center">
          <input type="checkbox" class="rounded border-gray-300 text-[#EFB85A] focus:ring-[#EFB85A]" data-filter="facility" data-value="geyser">
          <span class="ml-3 text-gray-700">Geyser</span>
        </label>
      </div>
    </div>
    
    <!-- Price Range -->
<div class="mb-8">
  <h3 class="text-lg font-semibold text-gray-800 mb-4">Price Range</h3>
  <div class="space-y-4">
    <div class="flex items-center space-x-4">
      <input type="range" 
             min="500" 
             max="50000" 
             value="20000" 
             class="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider" 
             id="priceRange" 
             oninput="updatePriceValue(this.value)">
    </div>
    <div class="flex justify-between text-sm text-gray-600">
      <span>₹500</span>
      <span id="priceValue" class="font-semibold text-[#F26538]">₹20,000</span>
      <span>₹50,000</span>
    </div>
  </div>
</div>

    
    <!-- Guests -->
    <div class="mb-8">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">Guests</h3>
      <div class="space-y-4">
        <div class="flex items-center justify-between">
          <span class="text-gray-700">Adults</span>
          <div class="flex items-center space-x-3">
            <button class="w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-100" onclick="decrementGuest('adults')">
              <span class="text-gray-600">-</span>
            </button>
            <span id="adultCount" class="w-8 text-center font-semibold">1</span>
            <button class="w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-100" onclick="incrementGuest('adults')">
              <span class="text-gray-600">+</span>
            </button>
          </div>
        </div>
        <div class="flex items-center justify-between">
          <span class="text-gray-700">Children</span>
          <div class="flex items-center space-x-3">
            <button class="w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-100" onclick="decrementGuest('children')">
              <span class="text-gray-600">-</span>
            </button>
            <span id="childCount" class="w-8 text-center font-semibold">0</span>
            <button class="w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-100" onclick="incrementGuest('children')">
              <span class="text-gray-600">+</span>
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Ratings -->
    <div class="mb-8">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">Ratings</h3>
       <h3 class="text-lg font-semibold text-gray-800 mb-4">Ratings</h3>
  <div class="flex space-x-2" id="starRating">
    <button class="star text-2xl text-gray-300 hover:text-[#EFB85A] transition-colors" data-rating="1" onclick="setRating(1)">★</button>
    <button class="star text-2xl text-gray-300 hover:text-[#EFB85A] transition-colors" data-rating="2" onclick="setRating(2)">★</button>
    <button class="star text-2xl text-gray-300 hover:text-[#EFB85A] transition-colors" data-rating="3" onclick="setRating(3)">★</button>
    <button class="star text-2xl text-gray-300 hover:text-[#EFB85A] transition-colors" data-rating="4" onclick="setRating(4)">★</button>
    <button class="star text-2xl text-gray-300 hover:text-[#EFB85A] transition-colors" data-rating="5" onclick="setRating(5)">★</button>
  </div>
  <div class="mt-2">
    <span id="ratingText" class="text-sm text-gray-600">No rating selected</span>
  </div>
    </div>
  </div>
  
  <!-- Sidebar Footer -->
  <div class="absolute bottom-0 left-0 right-0 p-2 bg-white border-t border-gray-200">
    <div class="flex space-x-4">
      <button onclick="clearAllFilters()" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
        Clear All
      </button>
      <button onclick="applyFilters()" id = "applyFilter" class="flex-1 px-4 py-2 bg-[#EFB85A] text-white rounded-lg hover:bg-[#F26538] transition-colors">
        Apply Filters
      </button>
    </div>
  </div>
</div>


      <div class="space-y-8 p-8">
        
            <!-- Dynamic Room Listings Container -->
            <div id="roomListingsContainer" class="space-y-8">
                <!-- Rooms will be dynamically inserted here -->
            </div>

            <!-- Dynamic Pagination Container -->
            <div id="paginationContainer" class="flex items-center justify-center mt-12 mb-8">
                <!-- Pagination will be dynamically inserted here -->
            </div>
        </main>
    </div>


      <!-- Footer -->
<footer class="bg-gray-100 text-gray-700 pt-2">
  <div class="max-w-7xl mx-auto px-6 py-12 grid grid-cols-1 md:grid-cols-3 gap-8">
    
    <!-- Logo & About -->
    <div class="text-left">
      <h2 class="text-4xl font-extrabold mb-4 bg-gradient-to-r from-orange-400 via-red-500 to-pink-600 bg-clip-text text-transparent">
        Zyra
      </h2>
      <p class="text-gray-600 mb-6">
        Experience luxury and comfort at Zyra Hotel. We provide exceptional hospitality with world-class amenities for an unforgettable stay.
      </p>
      <h3 class="font-semibold mb-2">Customer Support</h3>
      <p class="text-gray-600">feedback@gmail.com</p>
    </div>

        <!-- Quick Links -->
      <div class="grid grid-cols-2 gap-6">
        <div>
          <h3 class="font-semibold mb-4">Quick Links</h3>
          <ul class="space-y-2">
           <li><a href="/src/index.html" class="links">Home</a></li>
          <li><a href="/src/user/features/rooms/allRooms.html" class="links">Rooms</a></li>
          <li><a href="/src/user/features/facilities/facilities.html" class="links">Facilities</a></li>
          <li><a href="#testimonials" class="links">Reviews</a></li>
          <li><a href="/src/user/features/contact/contactUs.html" class="links">About us</a></li>
          </ul>
        </div>
        <div class="pt-8 md:pt-0">
          <ul class="space-y-2">
            <li><a href="#" class="links">FAQs</a></li>
            <li><a href="#" class="links">Privacy Policy</a></li>
            <li><a href="#" class="links">Terms and Condition</a></li>
          </ul>
        </div>
      </div>


    <!-- Social Media -->
    <div class="flex flex-col items-center md:items-start">
      <h3 class="font-semibold mb-4">Follow us</h3>
      <div class="flex space-x-6 text-2xl">
        <a href="#" class="text-[#1877F2] hover:opacity-80 transition" aria-label="Facebook">
          <i class="fab fa-facebook"></i>
        </a>
        <a href="#" class="text-[#1DA1F2] hover:opacity-80 transition" aria-label="Twitter">
          <i class="fab fa-twitter"></i>
        </a>
        <a href="#" class="text-[#0A66C2] hover:opacity-80 transition" aria-label="LinkedIn">
          <i class="fab fa-linkedin"></i>
        </a>
        <a href="#" class="text-[#E4405F] hover:opacity-80 transition" aria-label="Instagram">
          <i class="fab fa-instagram"></i>
        </a>
      </div>
    </div>
  </div>

  <!-- Copyright -->
  <div class="border-t border-gray-300 py-4 text-center text-sm text-gray-500">
    © 2025 Zyra Hotel | All rights reserved
  </div>
</footer>
  

<script>

  // Get lastSearch from localStorage (keeping this as it's needed for the application)
let lastSearch = null;
try {
    lastSearch = localStorage.getItem('lastSearch');
} catch (error) {
    console.warn('localStorage not available, continuing without lastSearch data');
}

// Define global variables
let filteredData = [];
let userData;
let bookingData = [];
let roomData = [];
let reviews = [];
let lastSearchData = null; // Store parsed lastSearch data

// In-memory booking data
const booking_existing_data = [];

// Pagination variables
let currentPage = 1;
let roomsPerPage = 4;
let totalPages = 1;

// Current data being displayed (either all rooms or filtered rooms)
let currentDisplayData = [];

// Function to update price value display
function updatePriceValue(value) {
    const priceValueElement = document.getElementById('priceValue');
    if (priceValueElement) {
        // Format the price with proper currency and commas
        const formattedPrice = `₹${parseInt(value).toLocaleString('en-IN')}`;
        priceValueElement.textContent = formattedPrice;
        console.log('Price updated to:', formattedPrice);
    }
}

// Fixed function to populate form fields with lastSearch data
function populateFormWithLastSearch() {
    if (!lastSearchData) return;
    
    try {
        console.log('Populating form with lastSearch data:', lastSearchData);
        
        // Populate check-in date
        if (lastSearchData.checkin && document.getElementById('checkInDate')) {
            document.getElementById('checkInDate').value = lastSearchData.checkin;
            console.log('Set check-in date:', lastSearchData.checkin);
        }
        
        // Populate check-out date  
        if (lastSearchData.checkout && document.getElementById('checkOutDate')) {
            document.getElementById('checkOutDate').value = lastSearchData.checkout;
            console.log('Set check-out date:', lastSearchData.checkout);
        }
        
        // Populate adult count (check different possible element IDs)
        const adultCountElement = document.getElementById('adultCount') || document.getElementById('adultsCount') || document.querySelector('[id*="adult"]');
        if (lastSearchData.adults && adultCountElement) {
            adultCountElement.innerText = lastSearchData.adults;
            console.log('Set adult count:', lastSearchData.adults);
        }
        
        // Populate children count (check different possible element IDs)
        const childCountElement = document.getElementById('childCount') || document.getElementById('childrenCount') || document.querySelector('[id*="child"]');
        if (lastSearchData.children !== undefined && childCountElement) {
            childCountElement.innerText = lastSearchData.children;
            console.log('Set children count:', lastSearchData.children);
        }
        
        // Set price range with proper initialization
        const priceRangeElement = document.getElementById('priceRange');
        if (priceRangeElement) {
            // Set default value if not specified
            const defaultPrice = 20000;
            priceRangeElement.value = defaultPrice;
            updatePriceValue(defaultPrice);
            console.log('Set price range to default:', defaultPrice);
        }
        
        // Trigger check-in change handler if function exists
        if (typeof handleCheckInChange === 'function' && lastSearchData.checkin) {
            handleCheckInChange();
        }
        
        console.log('✅ Form populated with lastSearch data successfully');
        
    } catch (error) {
        console.error('❌ Error populating form with lastSearch data:', error);
    }
}

// Initialize price range on page load
function initializePriceRange() {
    const priceRange = document.getElementById('priceRange');
    if (priceRange) {
        // Set initial value and update display
        const initialValue = priceRange.value || 20000;
        priceRange.value = initialValue;
        updatePriceValue(initialValue);
        
        // Add event listener as backup to oninput
        priceRange.addEventListener('input', function() {
            updatePriceValue(this.value);
        });
        
        console.log('Price range initialized with value:', initialValue);
    }
}

// Function to get current price filter value
function getCurrentPriceFilter() {
    const priceRange = document.getElementById('priceRange');
    return priceRange ? parseInt(priceRange.value) : 50000;
}

// Function to reset price range
function resetPriceRange() {
    const priceRange = document.getElementById('priceRange');
    if (priceRange) {
        priceRange.value = 20000;
        updatePriceValue(20000);
    }
}


// Function to open filter sidebar
function toggleFilterSidebar() {
  const sidebar = document.getElementById('filterSidebar');
  const overlay = document.getElementById('filterOverlay');
  
  sidebar.classList.remove('-translate-x-full');
  overlay.classList.remove('hidden');
  document.body.style.overflow = 'hidden';
}

// Function to close filter sidebar
function closeFilterSidebar() {
  const sidebar = document.getElementById('filterSidebar');
  const overlay = document.getElementById('filterOverlay');
  
  sidebar.classList.add('-translate-x-full');
  overlay.classList.add('hidden');
  document.body.style.overflow = 'auto';
}


// Function to set star rating (Fixed to work properly)
// Global variable to store current rating
let currentRating = 0;

// Simple function to set star rating (works with onclick)
function setRating(rating) {
    console.log(`Setting rating to: ${rating}`);
    
    // Update global rating
    currentRating = rating;
    
    // Get all star elements
    const stars = document.querySelectorAll('.star');
    
    if (stars.length === 0) {
        console.error('No stars found');
        return;
    }
    
    // Update each star
    stars.forEach((star, index) => {
        if (index < rating) {
            // Fill stars up to the selected rating
            star.style.color = '#EFB85A'; // Direct style for reliability
            star.className = star.className.replace(/text-gray-300|text-\[#EFB85A\]/g, '') + ' text-[#EFB85A]';
        } else {
            // Leave remaining stars gray
            star.style.color = '#d1d5db'; // Direct style for reliability
            star.className = star.className.replace(/text-gray-300|text-\[#EFB85A\]/g, '') + ' text-gray-300';
        }
    });
    
    // Update rating text
    const ratingText = document.getElementById('ratingText');
    if (ratingText) {
        const ratingLabels = {
            1: "Poor",
            2: "Fair", 
            3: "Good",
            4: "Very Good",
            5: "Excellent"
        };
        ratingText.textContent = `${rating} out of 5 stars - ${ratingLabels[rating]}`;
    }
    
    console.log(`Rating successfully set to: ${rating}`);
}

// Simple function to get current rating
function getCurrentRating() {
    return currentRating;
}

// Simple function to reset rating
function resetRating() {
    currentRating = 0;
    const stars = document.querySelectorAll('.star');
    
    stars.forEach(star => {
        star.style.color = '#d1d5db';
        star.className = star.className.replace(/text-gray-300|text-\[#EFB85A\]/g, '') + ' text-gray-300';
    });
    
    const ratingText = document.getElementById('ratingText');
    if (ratingText) {
        ratingText.textContent = 'No rating selected';
    }
}


// Function to format date to YYYY-MM-DD format
function formatDate(date) {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
}

// Function to handle check-in date change and update check-out minimum date
function handleCheckInChange() {
    const checkInInput = document.getElementById('checkInDate');
    const checkOutInput = document.getElementById('checkOutDate');
    
    if (!checkInInput || !checkOutInput) return;
    
    const checkInDate = new Date(checkInInput.value);
    
    if (checkInInput.value && !isNaN(checkInDate)) {
        // Set minimum check-out date to the day after check-in
        const minCheckOutDate = new Date(checkInDate);
        minCheckOutDate.setDate(minCheckOutDate.getDate() + 1);
        
        checkOutInput.min = formatDate(minCheckOutDate);
        
        // If current check-out date is before or equal to check-in date, clear it
        if (checkOutInput.value) {
            const checkOutDate = new Date(checkOutInput.value);
            if (checkOutDate <= checkInDate) {
                checkOutInput.value = '';
                console.log('Check-out date cleared because it was before or equal to check-in date');
            }
        }
        
        console.log(`Check-in date changed to: ${checkInInput.value}, minimum check-out date set to: ${formatDate(minCheckOutDate)}`);
    } else {
        // If check-in is cleared, remove the minimum restriction from check-out
        checkOutInput.removeAttribute('min');
        console.log('Check-in date cleared, removed check-out minimum restriction');
    }
}

// Function to populate form fields with lastSearch data
function populateFormWithLastSearch() {
    if (!lastSearchData) return;
    
    try {
        console.log('Populating form with lastSearch data:', lastSearchData);
        
        // Populate check-in date
        if (lastSearchData.checkin && document.getElementById('checkInDate')) {
            document.getElementById('checkInDate').value = lastSearchData.checkin;
            console.log('Set check-in date:', lastSearchData.checkin);
        }
        
        // Populate check-out date  
        if (lastSearchData.checkout && document.getElementById('checkOutDate')) {
            document.getElementById('checkOutDate').value = lastSearchData.checkout;
            console.log('Set check-out date:', lastSearchData.checkout);
        }
        
        // Populate adult count (check different possible element IDs)
        const adultCountElement = document.getElementById('adultCount') || document.getElementById('adultsCount') || document.querySelector('[id*="adult"]');
        if (lastSearchData.adults && adultCountElement) {
            adultCountElement.innerText = lastSearchData.adults;
            console.log('Set adult count:', lastSearchData.adults);
        }
        
        // Populate children count (check different possible element IDs)
        const childCountElement = document.getElementById('childCount') || document.getElementById('childrenCount') || document.querySelector('[id*="child"]');
        if (lastSearchData.children !== undefined && childCountElement) {
            childCountElement.innerText = lastSearchData.children;
            console.log('Set children count:', lastSearchData.children);
        }
        
        // Set price range with proper initialization
        const priceRangeElement = document.getElementById('priceRange');
        if (priceRangeElement) {
            // Set default value if not specified
            const defaultPrice = 20000;
            priceRangeElement.value = defaultPrice;
            updatePriceValue(defaultPrice);
            console.log('Set price range to default:', defaultPrice);
        }
        
        // Trigger check-in change handler if function exists
        if (typeof handleCheckInChange === 'function' && lastSearchData.checkin) {
            handleCheckInChange();
        }
        
        console.log('✅ Form populated with lastSearch data successfully');
        
    } catch (error) {
        console.error('❌ Error populating form with lastSearch data:', error);
    }
}

// Initialize price range on page load
function initializePriceRange() {
    const priceRange = document.getElementById('priceRange');
    if (priceRange) {
        // Set initial value and update display
        const initialValue = priceRange.value || 20000;
        priceRange.value = initialValue;
        updatePriceValue(initialValue);
        
        // Add event listener as backup to oninput
        priceRange.addEventListener('input', function() {
            updatePriceValue(this.value);
        });
        
        console.log('Price range initialized with value:', initialValue);
    }
}

// Function to get current price filter value
function getCurrentPriceFilter() {
    const priceRange = document.getElementById('priceRange');
    return priceRange ? parseInt(priceRange.value) : 50000;
}

// Function to reset price range
function resetPriceRange() {
    const priceRange = document.getElementById('priceRange');
    if (priceRange) {
        priceRange.value = 20000;
        updatePriceValue(20000);
    }
}

// Function to apply filters
function applyFilters() {
  // Implement your filter logic here
  console.log('Filters applied');
  console.log('Current rating:', currentRating);
  console.log('Adults:', adultCount);
  console.log('Children:', childCount);
  
  // Close sidebar after applying filters
  closeFilterSidebar();
}


// Utility: proper overlap check for date ranges
function isOverlap(requestStart, requestEnd, bookingStart, bookingEnd) {
    const reqStart = new Date(requestStart);
    const reqEnd = new Date(requestEnd);
    const bookStart = new Date(bookingStart);
    const bookEnd = new Date(bookingEnd);
    
    // Check if the requested dates overlap with existing booking
    // Overlap occurs if: request start < booking end AND request end > booking start
    return reqStart < bookEnd && reqEnd > bookStart;
}

// Fetch bookings and update in-memory array
async function fetchBookingData() {
    try {
        const bookingRes = await fetch('https://68c8b85aceef5a150f622643.mockapi.io/admin/3');
        if (!bookingRes.ok) {
            throw new Error(`HTTP error! status: ${bookingRes.status}`);
        }
        const data = await bookingRes.json();
        const bookings = data.bookings || [];
        
        // Update both arrays for compatibility
        booking_existing_data.length = 0;
        bookings.forEach(booking => booking_existing_data.push(booking));
        bookingData = [...bookings];
        
        console.log('Booking data loaded:', bookings);
        return bookings;
    } catch (error) {
        console.error('Error fetching bookings data:', error);
        return [];
    }
}

// Filter an array of rooms to those available in [checkinDate, checkoutDate)
function filterAvailableRooms(rooms, checkinDate, checkoutDate) {
    if (!checkinDate || !checkoutDate) return rooms;
    
    console.log(`Filtering rooms for availability between ${checkinDate} and ${checkoutDate}`);
    
    return rooms.filter(room => {
        const roomNumber = String(room.roomno || room.roomNo || '');
        
        // Get all confirmed bookings for this room (handle different status values)
        const roomBookings = booking_existing_data.filter(booking => {
            const bookingRoomNo = String(booking.roomno || booking.roomNo || '');
            const status = booking.status || '';
            
            // Only consider confirmed bookings (not cancelled, pending might still block)
            const isActiveBooking = status !== 'cancelled';
            const isSameRoom = bookingRoomNo === roomNumber;
            
            console.log(`Room ${roomNumber}: Checking booking - Room: ${bookingRoomNo}, Status: ${status}, Same Room: ${isSameRoom}, Active: ${isActiveBooking}`);
            
            return isSameRoom && isActiveBooking;
        });
        
        // Check if any booking overlaps with requested dates
        const hasConflict = roomBookings.some(booking => {
            const bookingCheckIn = booking.checkin || booking.checkIn;
            const bookingCheckOut = booking.checkout || booking.checkOut;
            
            // Skip bookings with invalid dates
            if (!bookingCheckIn || !bookingCheckOut) {
                console.log(`Skipping booking with invalid dates: CheckIn: ${bookingCheckIn}, CheckOut: ${bookingCheckOut}`);
                return false;
            }
            
            const hasOverlap = isOverlap(checkinDate, checkoutDate, bookingCheckIn, bookingCheckOut);
            
            console.log(`Room ${roomNumber}: Booking ${booking.id || 'unknown'} (${bookingCheckIn} to ${bookingCheckOut}) - Overlap: ${hasOverlap}`);
            
            return hasOverlap;
        });
        
        const isAvailable = !hasConflict;
        console.log(`Room ${roomNumber}: Available: ${isAvailable}`);
        
        return isAvailable;
    });
}

// Function to fetch room data
async function fetchRoomData() {
    try {
        const response = await fetch('https://68c8b85aceef5a150f622643.mockapi.io/admin/5');
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        roomData = data.rooms || [];
        console.log('Room data loaded:', roomData);
    } catch (error) {
        console.error('Error fetching room data:', error);
        roomData = [];
    }
}

// Function to fetch review data
async function fetchReviewData() {
    try {
        const response = await fetch('https://68c8b85aceef5a150f622643.mockapi.io/admin/8');
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        reviews = data['ratings-reviews'] || [];
        console.log('Review data loaded:', reviews);
    } catch (error) {
        console.error('Error fetching review data:', error);
        reviews = [];
    }
}

// Function to load all data
async function loadAllData() {
    await Promise.all([
        fetchBookingData(),
        fetchRoomData(),
        fetchReviewData()
    ]);
}


// Function to parse and apply lastSearch filter, then reset to default
function applyLastSearchFilter() {
    try {
        // Parse lastSearch data
        if (lastSearch) {
            lastSearchData = JSON.parse(lastSearch);
            console.log('Parsed LastSearch Data:', lastSearchData);
            
            // Populate form fields with lastSearch data
            populateFormWithLastSearch();
        } else {
            console.log('No lastSearch data found');
            currentDisplayData = [...roomData];
            updatePagination();
            return;
        }

        // Start with all room data
        let filteredRooms = [...roomData];

        // Extract lastSearch filter values
        const checkinDate = lastSearchData.checkin || '';
        const checkoutDate = lastSearchData.checkout || '';
        const adults = lastSearchData.adults || 0;
        const children = lastSearchData.children || 0;

        console.log('LastSearch Filters - Checkin:', checkinDate, 'Checkout:', checkoutDate, 'Adults:', adults, 'Children:', children);

        // Step 1: Filter rooms based on availability
        if (checkinDate && checkoutDate) {
            filteredRooms = filterAvailableRooms(filteredRooms, checkinDate, checkoutDate);
        }
        console.log('After LastSearch Availability Filter:', filteredRooms);

        // Step 2: Filter rooms based on guest capacity (adults and children)
        if (adults > 0 || children > 0) {
            filteredRooms = filteredRooms.filter(room => {
                const roomAdultMax = room.adultMax || 0;
                const roomChildMax = room.childrenMax || 0;
                
                const canAccommodateAdults = adults <= roomAdultMax;
                const canAccommodateChildren = children <= roomChildMax;
                
                console.log(`LastSearch Filter - Room ${room.roomno}: AdultMax: ${roomAdultMax}, ChildrenMax: ${roomChildMax}, Requested Adults: ${adults}, Children: ${children}, Can Accommodate: ${canAccommodateAdults && canAccommodateChildren}`);
                
                return canAccommodateAdults && canAccommodateChildren;
            });
        }
        console.log('After LastSearch Capacity Filter:', filteredRooms);

        // Update current display data
        filteredData = filteredRooms;
        currentDisplayData = filteredRooms;
        currentPage = 1; // Reset to first page
        updatePagination();

        console.log('Final LastSearch Filtered Rooms:', filteredRooms);
        
        // Reset lastSearch to default values after applying the filter
        resetLastSearchToDefault();
        
    } catch (error) {
        console.error('Error parsing lastSearch data:', error);
        // Fall back to showing all rooms if parsing fails
        currentDisplayData = [...roomData];
        updatePagination();
        
        // Still reset lastSearch even on error
        resetLastSearchToDefault();
    }
}

// Function to reset lastSearch to default values
function resetLastSearchToDefault() {
    try {
        const defaultLastSearch = {
            checkin: "",
            checkout: "",
            adults: 1,
            children: 0,
            timestamp: new Date().toISOString(),
            searchId: Date.now()
        };
        
        // Update localStorage with default values
        localStorage.setItem('lastSearch', JSON.stringify(defaultLastSearch));
        
        console.log('✅ LastSearch reset to default:', defaultLastSearch);
        
        // Update global variables
        lastSearch = JSON.stringify(defaultLastSearch);
        lastSearchData = defaultLastSearch;
        
    } catch (error) {
        console.error('❌ Error resetting lastSearch to default:', error);
    }
}


// Function to get user-entered filter data
function getUserFilterData() {
    const priceRange = document.getElementById('priceRange') ? document.getElementById('priceRange').value : 0;
    const checkInDate = document.getElementById('checkInDate') ? document.getElementById('checkInDate').value : '';
    const checkOutDate = document.getElementById('checkOutDate') ? document.getElementById('checkOutDate').value : '';
    const selectedFeatures = Array.from(document.querySelectorAll('input[data-filter="feature"]:checked')).map(input => input.dataset.value);
    const selectedFacilities = Array.from(document.querySelectorAll('input[data-filter="facility"]:checked')).map(input => input.dataset.value);
    const adultCount = document.getElementById('adultCount') ? parseInt(document.getElementById('adultCount').innerText, 10) : 0;
    const childCount = document.getElementById('childCount') ? parseInt(document.getElementById('childCount').innerText, 10) : 0;
    const stars = document.querySelectorAll('.star');
    const rating = Array.from(stars).filter(star => star.classList.contains('text-[#EFB85A]')).length;

    return {
        priceRange,
        checkInDate,
        checkOutDate,
        features: selectedFeatures,
        facilities: selectedFacilities,
        adultCount,
        childCount,
        rating
    };
}

// Function to update pagination based on current data
function updatePagination() {
    updateRoomsPerPage();
    totalPages = Math.ceil(currentDisplayData.length / roomsPerPage);
    currentPage = Math.min(currentPage, totalPages); // Ensure current page is valid
    if (currentPage < 1) currentPage = 1;
}

// Wait for DOM and then attach event listeners
function attachEventListeners() {
    // Apply Filter button event listener
    const applyFilterBtn = document.getElementById('applyFilter');
    if (applyFilterBtn) {
        applyFilterBtn.addEventListener('click', async function() {
            // Use current display data (which is already filtered by lastSearch) as the base
            let baseData = filteredData.length > 0 ? filteredData : [...roomData];
            
            // Log base data being used
            console.log('Base Data for Manual Filter (after lastSearch):', baseData);

            // Get user-entered data
            userData = getUserFilterData();

            // Log user-entered data
            console.log('User Manual Filter Data:', userData);

            // Filter rooms based on user data starting from lastSearch-filtered results
            let filteredRooms = [...baseData];

            // Step 1: Filter rooms based on availability (manual filter dates override lastSearch)
            if (userData.checkInDate && userData.checkOutDate) {
                filteredRooms = filterAvailableRooms(filteredRooms, userData.checkInDate, userData.checkOutDate);
            }
            console.log('After Manual Availability Filter:', filteredRooms);

            // Step 2: Filter rooms based on guest capacity (manual filter capacity override lastSearch)
            if (userData.adultCount > 0 || userData.childCount > 0) {
                filteredRooms = filteredRooms.filter(room => {
                    const roomAdultMax = room.adultMax || 0;
                    const roomChildMax = room.childrenMax || 0;
                    
                    // Check if room can accommodate the requested adults and children
                    const canAccommodateAdults = userData.adultCount <= roomAdultMax;
                    const canAccommodateChildren = userData.childCount <= roomChildMax;
                    
                    console.log(`Manual Filter - Room ${room.roomno}: AdultMax: ${roomAdultMax}, ChildrenMax: ${roomChildMax}, Requested Adults: ${userData.adultCount}, Children: ${userData.childCount}, Can Accommodate: ${canAccommodateAdults && canAccommodateChildren}`);
                    
                    return canAccommodateAdults && canAccommodateChildren;
                });
            }
            console.log('After Manual Capacity Filter:', filteredRooms);

            // Step 3: Filter rooms based on features
            if (userData.features.length > 0) {
                let k = userData.features.map(feature => feature.toLowerCase());
                console.log("User features in lowercase (k array):", k);
                
                filteredRooms = filteredRooms.filter(room => {
                    if (!room.selectedFeatures || room.selectedFeatures.length === 0) return false;
                    const roomFeatures = room.selectedFeatures.map(f => (f.name || f).toLowerCase());
                    console.log("Room", room.roomno, "features:", roomFeatures);
                    
                    const hasAllFeatures = k.every(userFeature => roomFeatures.includes(userFeature));
                    console.log("Room", room.roomno, "has all required features:", hasAllFeatures);
                    
                    return hasAllFeatures;
                });
            }
            console.log('After Features Filter:', filteredRooms);

            // Step 4: Filter rooms based on facilities
            if (userData.facilities.length > 0) {
                let facilityArray = userData.facilities.map(facility => facility.toLowerCase());
                console.log("User facilities in lowercase:", facilityArray);
                
                filteredRooms = filteredRooms.filter(room => {
                    if (!room.selectedFacilities || room.selectedFacilities.length === 0) return false;
                    const roomFacilities = room.selectedFacilities.map(f => (f.name || f).toLowerCase());
                    console.log("Room", room.roomno, "facilities:", roomFacilities);
                    
                    const hasAllFacilities = facilityArray.every(userFacility => roomFacilities.includes(userFacility));
                    console.log("Room", room.roomno, "has all required facilities:", hasAllFacilities);
                    
                    return hasAllFacilities;
                });
            }
            console.log('After Facilities Filter:', filteredRooms);

            // Step 5: Filter rooms based on price
            if (userData.priceRange && userData.priceRange !== "0") {
                filteredRooms = filteredRooms.filter(room => {
                    const roomPrice = parseInt(room.price.replace(/[^0-9]/g, ''), 10);
                    const userPrice = parseInt(userData.priceRange, 10);
                    return roomPrice <= userPrice; // Changed from >= to <= for price range filtering
                });
            }
            console.log('After Price Filter:', filteredRooms);

            // Step 6: Filter rooms based on reviews
            if (userData.rating > 0) {
                filteredRooms = filteredRooms.filter(room => {
                    const roomNumber = String(room.roomno || room.roomNo || '');
                    const roomReviews = reviews.filter(review => {
                        const reviewRoomNo = String(review.roomNo || '');
                        return reviewRoomNo === roomNumber;
                    });
                    
                    console.log(`Rating Filter - Room ${roomNumber}: Found ${roomReviews.length} reviews`);
                    if (roomReviews.length > 0) {
                        console.log(`Room ${roomNumber} reviews:`, roomReviews.map(r => ({ rating: r.rating, user: r.userName })));
                    }
                    
                    const hasMatchingRating = roomReviews.some(review => review.rating >= userData.rating);
                    console.log(`Room ${roomNumber}: Has rating >= ${userData.rating}: ${hasMatchingRating}`);
                    
                    return hasMatchingRating;
                });
            }
            console.log('After Reviews Filter:', filteredRooms);

            // Update current display data and pagination
            currentDisplayData = filteredRooms;
            currentPage = 1; // Reset to first page
            updatePagination();
            
            console.log('Final Manual Filtered Rooms:', filteredRooms);
            
            // Render the filtered results
            renderCurrentPage();
        });
    }
    
    
    // Initialize price range slider
    const priceRange = document.getElementById('priceRange');
    if (priceRange) {
        priceRange.max = 50000;
        priceRange.addEventListener('input', function() {
            updatePriceValue(this.value);
        });
    }
    
    // Initialize check-in date change handler
    const checkInInput = document.getElementById('checkInDate');
    if (checkInInput) {
        checkInInput.addEventListener('change', handleCheckInChange);
        console.log('Check-in date change handler attached');
    }
    
    // Set today's date as minimum for check-in date
    const today = new Date();
    if (checkInInput) {
        checkInInput.min = formatDate(today);
        console.log(`Minimum check-in date set to today: ${formatDate(today)}`);
    }
    
    // Set tomorrow's date as minimum for check-out if no check-in is selected
    const checkOutInput = document.getElementById('checkOutDate');
    const tomorrow = new Date(today);
    tomorrow.setDate(tomorrow.getDate() + 1);
    if (checkOutInput && !checkInInput.value) {
        checkOutInput.min = formatDate(tomorrow);
        console.log(`Initial minimum check-out date set to tomorrow: ${formatDate(tomorrow)}`);
    }
}

// Dynamic rooms per page based on screen size
function updateRoomsPerPage() {
    if (window.innerWidth < 640) {
        roomsPerPage = 2; // Mobile
    } else if (window.innerWidth < 1024) {
        roomsPerPage = 3; // Tablet
    } else {
        roomsPerPage = 4; // Desktop
    }
}

// Function to render a single room
function renderRoom(room) {
    const imageUrl = room.thumbnailUrl && room.images.length > 0 
        ? room.images[0].url || room.images[0] 
        : '';
    
    const features = room.selectedFeatures || [];
    const facilities = room.selectedFacilities || [];
   
    return `
        <div class="bg-white p-4 sm:p-6 rounded-2xl shadow-md mx-auto max-w-7xl border-l-[3px] border-[#EFB85A] mb-4 sm:mb-6">
            <div class="flex flex-col lg:flex-row gap-6 lg:gap-10">
                
                <!-- Room Image with Responsive Dimensions -->
                <div class="lg:w-3/5 w-full p-1 sm:p-2">
                    <div class="w-full h-[250px] sm:h-[300px] lg:h-[400px] bg-gray-100 rounded-xl overflow-hidden">
                        ${imageUrl 
                            ? `<img src="${imageUrl}" alt="${room.categoryType}" class="w-full h-full object-cover rounded-xl" width="600" height="320">` 
                            : `<div class="w-full h-full flex items-center justify-center">
                                 <span class="text-gray-500 text-base sm:text-lg">Room Image</span>
                               </div>`
                        }
                    </div>
                </div>
                
                <!-- Room Details -->
                <div class="lg:w-2/5 w-full flex flex-col justify-between">
                    
                    <!-- Top Section -->
                    <div>
                        <!-- Room Title -->
                        <h3 class="text-xl sm:text-2xl lg:text-3xl font-bold text-gray-900 mb-3 sm:mb-4">${room.categoryType}</h3>
                         
                        <!-- Features Section -->
                        ${features.length > 0 ? `
                        <div class="mb-4 sm:mb-5">
                            <h4 class="text-sm sm:text-base font-semibold text-gray-800 mb-2 sm:mb-3">Features</h4>
                            <div class="flex flex-wrap gap-1.5 sm:gap-2">
                                ${features.map(feature => 
                                    `<span class="bg-gray-100 text-gray-600 px-2 sm:px-3 py-1 sm:py-1.5 font-semibold rounded-full text-xs sm:text-sm capitalize">${feature.name || feature}</span>`
                                ).join('')}
                            </div>
                        </div>
                        ` : ''}
                        
                       <!-- Facilities Section -->
                        ${facilities.length > 0 ? `
                            <div class="mb-4 sm:mb-5">
                                <h4 class="text-sm sm:text-base font-semibold text-gray-800 mb-2 sm:mb-3">Facilities</h4>
                                <div class="flex flex-wrap gap-3 sm:gap-4 text-gray-500">
                                    ${facilities.map(facility => 
                                        `<img src="${facility.icon}" alt="${facility.name}" title="${facility.name}" class="w-5 h-5 sm:w-6 sm:h-6" />`
                                    ).join('')}
                                </div>
                            </div>
                        ` : ''}

                        <!-- Guest Info -->
                        <div class="mb-3 sm:mb-4">
                            <h4 class="text-sm sm:text-base font-semibold text-gray-800 mb-2">Guest</h4>
                            <div class="text-sm text-gray-500 font-semibold">
                                <span>${room.adultMax || 0} Adults</span>
                                <span class="ml-4 sm:ml-6">${room.childrenMax || 0} Children</span>
                            </div>
                        </div>
                        
                        <!-- Area Info -->
                        ${room.area ? `
                        <div class="mb-4">
                            <h4 class="text-sm sm:text-base font-semibold text-gray-800 mb-2">Area</h4>
                            <div class="text-sm text-gray-500 font-semibold">
                                <span>${room.area} sq ft</span>
                            </div>
                        </div>
                        ` : ''}
                    </div>
                    <!-- Bottom Section - Responsive Layout -->
                    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 sm:gap-0">
                        <div class="flex items-baseline">
                            <span class="text-xl sm:text-2xl font-bold text-gray-800">${room.price || '$0'}</span>
                            <span class="text-sm sm:text-base font-bold text-gray-600 ml-1">per night</span>
                        </div>
                        
                        <!-- Buttons Section with "More Details" below "Book Now" on all screen sizes -->
                        <div class="flex flex-col sm:flex-col items-start sm:items-center gap-2 sm:gap-1 w-full sm:w-auto mr-6">
                            <!-- Book Now Button (Always placed above) -->
                            <button class="bg-[#EFB85A] hover:bg-[#F26538] text-sm text-white px-4 sm:px-5 py-2.5 sm:py-3 rounded-full font-medium transition-colors w-full sm:w-auto" 
                                    onclick="bookRoom(${room.id})">
                                Book Now
                            </button>

                            <!-- More Details Link (Always placed below on all screen sizes) -->
                            <a href="#" class="text-gray-600 hover:text-[#E11162] font-semibold text-xs underline underline-offset-4 decoration-2 transition-colors text-center sm:text-left w-full sm:w-auto sm:ml-4 sm:mt-1 mr-3" 
                              onclick="bookRoom(${room.id})">
                                More Details
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

// Function to render responsive pagination
function renderPagination() {
    if (totalPages <= 1) return '';
    
    let paginationHTML = `
        <nav class="flex flex-col sm:flex-row items-center justify-center space-y-2 sm:space-y-0 sm:space-x-2 px-4" role="navigation" aria-label="Pagination Navigation">
            <!-- Previous Button -->
            <button class="flex items-center px-3 sm:px-4 py-2 sm:py-2.5 text-xs sm:text-sm font-medium text-gray-600 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 w-full sm:w-auto justify-center" 
                    ${currentPage === 1 ? 'disabled' : ''} 
                    onclick="changePage(${currentPage - 1})">
                <svg class="w-3 h-3 sm:w-4 sm:h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
                Previous
            </button>
            
            <!-- Page Numbers -->
            <div class="flex items-center space-x-1 overflow-x-auto">
    `;
    
    // Calculate page range to display
    let start = Math.max(1, currentPage - 2);
    let end = Math.min(totalPages, start + 4);
    
    // Adjust start if we're near the end
    if (end - start < 4) {
        start = Math.max(1, end - 4);
    }
    
    // First page
    if (start > 1) {
        paginationHTML += `
            <button class="px-2.5 sm:px-3.5 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-gray-600 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-700 transition-colors duration-200" 
                    onclick="changePage(1)">1</button>
        `;
        if (start > 2) {
            paginationHTML += `<span class="px-1 sm:px-2 py-1.5 sm:py-2 text-xs sm:text-sm text-gray-500">...</span>`;
        }
    }
    
    // Page numbers
    for (let i = start; i <= end; i++) {
        paginationHTML += `
            <button class="px-2.5 sm:px-3.5 py-1.5 sm:py-2 text-xs sm:text-sm font-medium ${i === currentPage 
                ? 'text-white bg-[#EFB85A] border-[#EFB85A] hover:bg-[#F26538]' 
                : 'text-gray-600 bg-white border-gray-300 hover:bg-gray-50 hover:text-gray-700'} 
                border rounded-lg transition-colors duration-200" 
                    ${i === currentPage ? 'aria-current="page"' : ''} 
                    onclick="changePage(${i})">${i}</button>
        `;
    }
    
    // Last page
    if (end < totalPages) {
        if (end < totalPages - 1) {
            paginationHTML += `<span class="px-1 sm:px-2 py-1.5 sm:py-2 text-xs sm:text-sm text-gray-500">...</span>`;
        }
        paginationHTML += `
            <button class="px-2.5 sm:px-3.5 py-1.5 sm:py-2 text-xs sm:text-sm font-medium text-gray-600 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-700 transition-colors duration-200" 
                    onclick="changePage(${totalPages})">${totalPages}</button>
        `;
    }
    
    paginationHTML += `
            </div>
            
            <!-- Next Button -->
            <button class="flex items-center px-3 sm:px-4 py-2 sm:py-2.5 text-xs sm:text-sm font-medium text-gray-600 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-700 transition-colors duration-200 w-full sm:w-auto justify-center" 
                    ${currentPage === totalPages ? 'disabled' : ''} 
                    onclick="changePage(${currentPage + 1})">
                Next
                <svg class="w-3 h-3 sm:w-4 sm:h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </button>
        </nav>
    `;
    
    return paginationHTML;
}

// Function to render rooms for current page
function renderCurrentPage() {
    const startIndex = (currentPage - 1) * roomsPerPage;
    const endIndex = startIndex + roomsPerPage;
    const currentRooms = currentDisplayData.slice(startIndex, endIndex);
    
    const container = document.getElementById('roomListingsContainer');
    if (container) {
        if (currentRooms.length === 0) {
            container.innerHTML = `
                <div class="text-center py-8 sm:py-12 px-4">
                    <p class="text-gray-500 text-base sm:text-lg">No rooms found matching your criteria.</p>
                </div>
            `;
        } else {
            container.innerHTML = currentRooms.map(room => renderRoom(room)).join('');
        }
    }
    
    const paginationContainer = document.getElementById('paginationContainer');
    if (paginationContainer) {
        paginationContainer.innerHTML = renderPagination();
    }
}

// Function to change page
function changePage(page) {
    if (page >= 1 && page <= totalPages) {
        currentPage = page;
        renderCurrentPage();
        
        // Scroll to top of room listings
        const container = document.getElementById('roomListingsContainer');
        if (container) {
            container.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }
    }
}

// Function to handle room booking
function bookRoom(roomId) {
    const room = currentDisplayData.find(r => r.id === roomId);

    if (room) {
        try {
            // Store as JSON string in localStorage
            localStorage.setItem('currentRoom', JSON.stringify(room));
            // If you also want to save just room number separately
            localStorage.setItem('roomno', room.roomno);
        } catch (error) {
            console.warn('localStorage not available, room data stored in memory only');
            // You could store in a global variable as fallback
            window.currentRoomData = room;
        }

        // Navigate to next page
        window.location.href = '/src/user/features/rooms/room.html';
    }
}

// Function to show room details
function showRoomDetails(roomId) {
    const room = currentDisplayData.find(r => r.id === roomId);
    if (room) {
        console.log('Room details:', room);
        // Implement your room details modal/page logic here
        alert(`Showing details for ${room.categoryType} - Room ${room.roomno}`);
    }
}

// Debounced resize handler to improve performance
let resizeTimeout;
function handleResize() {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(() => {
        const oldRoomsPerPage = roomsPerPage;
        updateRoomsPerPage();
        
        // Only re-render if rooms per page changed
        if (oldRoomsPerPage !== roomsPerPage) {
            updatePagination();
            renderCurrentPage();
        }
    }, 250); // 250ms debounce
}


// Updated initialization function with automatic lastSearch reset
async function initializeRoomDetails() {
    try {
        await loadAllData();
        
        console.log("Room Data:", roomData);
        console.log('Reviews:', reviews);
        console.log('Booking Data:', bookingData);

        // Apply lastSearch filter automatically on page load (only once)
        applyLastSearchFilter();
        
        // Render the filtered results
        renderCurrentPage();
        
        // Attach event listeners after DOM is ready
        setTimeout(attachEventListeners, 100);
        
    } catch (error) {
        console.error('Error initializing room details:', error);
        const container = document.getElementById('roomListingsContainer');
        if (container) {
            container.innerHTML = `
                <div class="text-center py-8 sm:py-12 px-4">
                    <p class="text-gray-500 text-base sm:text-lg">Error loading rooms. Please try again later.</p>
                </div>
            `;
        }
        
        // Reset lastSearch even on initialization error
        resetLastSearchToDefault();
    }
}


// Event listeners
document.addEventListener('DOMContentLoaded', function () {
   initializePriceRange();
    initializeRoomDetails();
   
    // Add resize event listener with debouncing
    window.addEventListener('resize', handleResize);
});

// Clean up event listener when page unloads
window.addEventListener('beforeunload', function() {
    window.removeEventListener('resize', handleResize);
});

</script>

  <script src="allRooms.js"></script>
  <script src ="/src/auth.js"></script>
</body>
</html>


